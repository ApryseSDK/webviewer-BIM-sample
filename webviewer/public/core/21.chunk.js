/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{474:function(Ba,va,r){r.r(va);var oa=r(0),na=r(10),ma=r(2);Ba=r(48);var fa=r(22),da=r(11);r=function(){function aa(){this.init()}aa.prototype.init=function(){this.c9=!1;this.$e=this.El=this.connection=null;this.zs={};this.fa=this.fG=null};aa.prototype.Spa=function(y){for(var x=this,h=0;h<y.length;++h){var b=y[h];switch(b.at){case "create":this.zs[b.author]||(this.zs[b.author]=b.aName);this.nga(b);break;case "modify":this.fa.nm(b.xfdf).then(function(e){x.fa.kb(e[0])});
break;case "delete":this.fa.nm("<delete><id>"+b.aId+"</id></delete>")}}};aa.prototype.nga=function(y){var x=this;this.fa.nm(y.xfdf).then(function(h){h=h[0];h.authorId=y.author;x.fa.kb(h);x.fa.trigger(na.b.UPDATE_ANNOTATION_PERMISSION,[h])})};aa.prototype.Pfa=function(y,x,h){this.El&&this.El(y,x,h)};aa.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Pfa.bind(this,y,"add",{imported:!1}),{once:!0})};aa.prototype.initiateCollaboration=function(y,
x,h){var b=this;if(y){b.$e=x;b.fa=h.ma();h.addEventListener(na.e.DOCUMENT_UNLOADED,function(){b.disableCollaboration()});b.sqa(y);var e=new XMLHttpRequest;e.addEventListener("load",function(){if(200===e.status&&0<e.responseText.length)try{var a=JSON.parse(e.responseText);b.connection=exports.Ua.$qa(Object(fa.k)(b.$e,"blackbox/"),"annot");b.fG=a.id;b.zs[a.id]=a.user_name;b.fa.xN(a.id);b.connection.Zta(function(f){f.t&&f.t.startsWith("a_")&&f.data&&b.Spa(f.data)},function(){b.connection.send({t:"a_retrieve",
dId:y});b.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[b.zs[a.id],b.fG])},function(){b.disableCollaboration()})}catch(f){Object(ma.g)(f.message)}});e.open("GET",Object(fa.k)(this.$e,"demo/SessionInfo.jsp"));e.withCredentials=!0;e.send();b.c9=!0;b.fa.F_(function(a){return b.zs[a.Author]||a.Author})}else Object(ma.g)("Document ID required for collaboration")};aa.prototype.disableCollaboration=function(){this.El&&(this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.El),this.El=
null);this.connection&&this.connection.fq();this.fa&&this.fa.xN("Guest");this.init();this.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};aa.prototype.sqa=function(y){var x=this;this.El&&this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.El);this.El=function(h,b,e){return Object(oa.b)(this,void 0,void 0,function(){var a,f,n,z,w,ea,ka,ca,ba;return Object(oa.d)(this,function(ia){switch(ia.label){case 0:if(e.imported)return[2];a={t:"a_"+b,dId:y,annots:[]};return[4,x.fa.BJ()];case 1:f=
ia.ca();"delete"!==b&&(n=(new DOMParser).parseFromString(f,"text/xml"),z=new XMLSerializer);for(w=0;w<h.length;w++)ea=h[w],ca=ka=void 0,"add"===b?(ka=n.querySelector('[name="'+ea.Id+'"]'),ca=z.serializeToString(ka),ba=null,ea.InReplyTo&&(ba=x.fa.rf(ea.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:ea.Id,author:x.fG,aName:x.zs[x.fG],parent:ba,xfdf:"<add>"+ca+"</add>"})):"modify"===b?(ka=n.querySelector('[name="'+ea.Id+'"]'),ca=z.serializeToString(ka),a.annots.push({at:"modify",aId:ea.Id,
xfdf:"<modify>"+ca+"</modify>"})):"delete"===b&&a.annots.push({at:"delete",aId:ea.Id});0<a.annots.length&&x.connection.send(a);return[2]}})})}.bind(x);this.fa.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.El)};aa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return aa}();Object(Ba.a)(r);va["default"]=r}}]);}).call(this || window)
